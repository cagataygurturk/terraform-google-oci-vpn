# HA VPN between GCP and OCI

This repository contains a drop-in Terraform module that sets up a HA VPN between Azure and Oracle Cloud Infrastructure (OCI).

## Features:

- On GCP side a HA VPN is set up with two or four tunnels. (See [documentation](https://cloud.google.com/network-connectivity/docs/vpn/how-to/creating-ha-vpn))
- On OCI side two Site-to-Site VPN connections are set up with two connections.
- Both sides are configured to establish BGP sessions between each other, so two platforms automatically learn the routes from each other.
- Proper routes are propagated from the GCP side to enable Private Google Access from OCI.

## Installation 

On OCI side: A compartment, a Distributed Routing Gateway (DRG)
On GCP side: A project, a VPC network

## Notes on high availability

For an HA VPN, Google cloud creates two IP addresses which must be utilised at least by one tunnel each. When a Site-to-site VPN is installed on OCI side, also two tunnels are created with two diverse IPs. However, unfortunately OCI does not support these IPs to connect to two different Customer Premise Equipments (CPE). For this reason, this module deploys to Site-to-Site VPNs that yields four tunnels. The module also allows creating four tunnels on GCP side (two for each GCP VPN IPs). If this option is used, full high availability and higher bandwidth is achieved. However, unlike OCI, each tunnel costs extra at GCP side and four tunnels might be overkill. In this case, the module provides `four_tunnels_redundancy` option to use only two tunnels. In this case, each GCP IP is terminated to one of the tunnels of two Site-to-site VPNs on OCI side. With this setup, only one tunnel of each VPNs on OCI will be utilised and OCI might complain that this setup is not highly available. However, as we establish two VPNs, high availability will still be achieved.